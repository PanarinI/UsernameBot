flowchart TD
  %% Определяем стили
  classDef success fill:#99ff99,stroke:#008000,stroke-width:2px;
  classDef failure fill:#ff9999,stroke:#cc0000,stroke-width:2px;

  %% Начало
  A[Пользователь вводит контекст] --> B[Генерация username через OpenAI]

  %% Процесс генерации
  B --> C{OpenAI API: Ответ на запрос}
  C -- "API вернул данные" --> D[Парсинг ответа: категория и username]
  D --> E[Проверка валидности каждого username]

  %% Процесс проверки каждого username
  E --> F{Проверка доступности через Telegram API}
  F -- "Имя найдено" --> G[Username занят, сохраняем в базу с статусом 'Занято']
  F -- "Имя не найдено" --> H[Username свободен, сохраняем в базу с статусом 'Свободно']

  %% Сохранение в базу
  G --> I[Сохранение username в базу данных]
  H --> I[Сохранение username в базу данных]

  %% Завершающий этап
  I --> J[Продолжение проверки других имен или завершение]

  %% Обработка ошибок
  C -- "API не вернул данные" --> K[Ошибка генерации, возвращаем пустой список]
  K --> J
  F -- "Ошибка при проверке доступности" --> L[Ошибка при проверке username, пропускаем]
  L --> J

  %% Применяем стили
  class A,B,D,E,F,G,H,I success;
  class K,L failure;
